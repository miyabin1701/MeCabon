
Mecabon readme.txt

MeCabonをご覧いただき有難うございます。

　本やテキストファイルを読むのが辛くなってきたので、読み上げてもらおうと
作成したアプリケーションです。目と手は作業を行いながらノベル（テキストファイル）を
聞くことが可能になります。ただし、誤読チェックをしようとすると目で文書を追いかける
必要があります。

　形態素解析ライブラリのMecabを使わせて頂き、漢字読み変換を行っています。
　Mecabの辞書をアップデートすることで、適切な読みになっていくことを期待しています。
　再生停止時にMecabのシステム辞書をボタン１押しで更新できるようにしましたので随時更
新してください。最初ユーザー辞書の更新で対応しようとしましたが、ユーザ辞書用のコスト
推定では、そちらが優先され、システム辞書側の語彙が使われなくなるため、小説のような
同じ語彙が複数の読み方をしなければならない用途には不向きと思い、ユーザー辞書は非使用
にしました。現在読み分けが難しいのは　様、風、方、行って、止め　等のようです。
　今後ユーザーの皆さんが新規に登録した語彙やコーパスを共有しあい、より誤読の無い辞書
に育てていきたいと思っています。今回使用した辞書ファイルは
 mecab-ipadic-2.7.0-20070801.tar です。対応したモデルファイルが
 mecab-ipadic-2.7.0-20070801.model が在るのでシステム辞書を更新可能になりました。
 neologd 辞書でも良いかもしれません。

　また、発声は株式会社 アクエストさんのAquesTalk10を使わせて頂き開発を行いました。
数々の発音できない文字や文字列があり、発音できる文字に変換しています。（"ヴ"→"ぶ"、
"ふゅ"→"ふー"、等々）どのノベルを読んでも違和感が残るかもしれませんが、アクエスト
さんの対応を期待しましょう！どの文字、文字列が発音できないかは音声記号列仕様書
siyo_onseikigou.pdfの読み記号表を参照してください。
　その後、SAPIの対応を行いましたが現在のところ、Waveデータ生成毎、前後に長い無音状
態が在り、後部の無音部分は結構削りましたが、聞いていて気になります。どうすればいい
のか困惑中です。SAPIの設定オプションはただカタカナを入れた際と、SSMLを入れた際で有
効無効がある様です。SAPIの際WAVEデータをメモリー内で受け渡しできなかった（パイプも
不能）のでファイル渡しになっています。環境変数ユーザーTMPフォルダーに生成しています。
RAMディスクなど書き込み回数が気にならないフォルダーに設定してください。

　Mecabonの使い方

・まず、MeCabを作者様サイトからダウンロード＆インストールしてください。
	https://taku910.github.io/mecab/#download
	Binary package for MS-Windows

	辞書の更新作業に使います。libmecab.dllはMeCabon同梱の物を使います。（このソフトが64bitビルドのため）


・MeCabonを起動するとメインダイヤログが表示されます。
　最初にご利用の際は、設定ダイヤログのMecabタブの項目について設定を行ってください。
　設定ダイヤログの表示はエディットコントロール内で右クリックした際のポップアップ
　メニューから行ってください。

　Mecab.exeのパス
　辞書更新時はこのパスからmecab-dict-index.exe等他のツールを起動します。

　システム辞書フォルダー
　　下記辞書ホルダー構成の　n:\.......\final　の部分を設定してください。

　システム辞書構築フォルダー
　辞書構築フォルダーは下記構成となります。　n:\.......\work　の部分を設定してください。
　  n:\......\work\seed
                  \final
　文字セットは現在UTF-8固定になっています。
　text editorは、utf-8文字セットが使える物なら、普段使いのエディターを設定してください。
　utf-8が使えない場合はnotepad++が良いかもしれません。
　editor option　は、エディター起動オプションでタグジャンプ時の行番号とファイルパスの
　与え方を指定してください。csv辞書ファイル検索後、該当位置にタグジャンプするための設定です。

　notepad++の場合は		-n%l %f		です。　%lは行番号に、%fはファイル名に置き換えられます。

　一番下に　TTSセレクト用リストボックスがありますので、とりあえず、AQTK10でお試しください。
　このセレクタの設定されているTTSのオプションタブを開くことができます。
　TTS設定タブは、とりあえず、いじらなくても発声することが可能です。

　OKボタンで設定ダイヤログを閉じてください。

　後は、メインダイヤログのエディットコントロールにテキストをコピペするか、ドラッグドロップ
するかして、PLAYボタンを押すだけです。PLAY状態になるとPLAYボタンはPOUSEボタンに替わります。
　発声時、Mecabの未登録語（以後未知語）やAquesTalkのWAVE生成エラーは別ダイヤログに表示
されます。　発声の停止はSTOPボタンでお願いします。

　ファイルのドラッグドロップ時は、一応文字コード判別（UTF-8,UTF16-LE等）を行い変換を行って
いますが、何でも変換できるわけではございませんので、予めユニコードに変換されることをお勧め
します。

　初見の文章はMecabの未知語が多数出てくると思われます。この際、発声はスキップして未知語を
すべて洗い出して、未知語を辞書に登録する方がいいと思います。発声スキップオプションもポップ
アップメニューにつけています。ご利用ください。例えばカタカナの名前で在っても、登録すること
で前後の漢字の解析精度が上がるようです。

　発声時に、読み間違いも出てきます。聞いていて違うと感じた際は、PAUSEして読み間違いの文章を
選択して、ポップアップメニューのcorpasを使ってください。別ダイヤログにコーパス形式の表示を
行います。読み間違いの語彙のコーパス行にカーソルを持っていき、ポップアップメニューの検索を
行ってください。別ダイヤログの検索文字列エリアに半角カンマをアペンドして張り付けますので。
改めて、検索ボタンを押してください。csv辞書ファイル検索結果を表示します。正解の読み品詞が
あればテキストエディタにコーパスダイヤログの一連のコーパス行をコピペして頂き、読み間違い行を
検索結果の読み正解行に置き換えてください。もし、csv辞書検索結果に読みの正解が表示されなかっ
た場合は、追加用の辞書に登録していってください。また、送り仮名の過不足で検索ができないことも
在ります。検索文字列に追記して検索することで検索できることもありました。
　ある程度、新規追加語、コーパスがたまったら、辞書を更新してください。csv辞書検索他ダイヤ
ログのbuildsysdicボタンで更新できます。少し時間がかかります。辞書更新の際は、STOPボタンで
発声を停止してください。発声中はlibmecab.dllが辞書を開いているためロックがかかってファイルの
更新ができないのです。そのうえ、見た目は正常に更新終了したと振舞うため更新したのに出来ていな
かったことがあり得ます。辞書のビルドエラーについて、追加した語彙又は、コーパスファイルのフォー
マットエラー、ファイル末尾の改行だけの行であることがほとんどです。追加した部分を再確認して
ください。　追加用の辞書は、一般的な語彙の辞書とその本専用辞書（登場人物の名前や特有の言い
回し）を分けて行うと良いでしょう。work\seedフォルダー内であれば拡張子が.csvのファイルを追加
してもmecabは辞書をビルドしてくれます。

メインダイヤログのポップアップメニューでその他に
　・ディスプレイ電源連動PAUSE　PCので設定時間後にモニターの電源を切る設定を行っていた際に自動で
　　PAUSEします。モニターのスピーカーから音を出している場合にお使いください。私の寝落ち対策；；
　　また、モニター電源オフ時にも再生可能なUSBスピーカーなどから鳴らす場合はチェックを外してください。
	メッセージが来ないときがあるようでPAUSEにならない時が在るようです。気休め程度とお考え下さい。
　・記号読みパス　通常！マークなどいくつかの記号（発音記号でない記号）を"びっくり"等と発声します。
　　それをパスする際の設定です。辞書で登録している記号の読みは除きます。
　・発声スキップ　先ほど述べた、初見の文章の未知語を洗い出すためのオプションです。
　・この行から再生　カーソルのある行から再生します。
　・この上の行まで削除　先頭からカーソルのある行の上の行まで削除します。
　・前回ドラッグ＆ドロップしたファイルパス　続きを読めるようにしました。前回MeCabonを終了した
　　時に持っていた行番号付近にスクロールしますので、上記この行から再生メニューで再生してください。

メインダイヤログの下部のボタンなど
　・検索ボタン　横のエディットボックス内の文字列を検索します。
　　前回何話まで読んだ等の場合、（何＋１）話等の文字列を検索してください。
　　何メガもの文章を読み込めるので、検索機能が無いと探すのが辛かったので追加しました。
　・Volumeスライドバー　サウンドAPIのボリューム設定です。即時音量を変えられます。
　　設定ダイヤログの各TTSの設定内にもボリューム設定がありますが、そちらは、生成波形の大きさを
　　コントロールします。当然、波形生成済みで再生キューに入っている分は音量を変化することはできません。
　・ダイヤログ内の文字サイズ　CTRL＋ジョグダイヤルで変更可能です。

メインダイヤログのエディットコントロールは読んでいる際、読んでいる行辺りを反転表示します。
しかし、何行かをキューに入れるので、その辺り程度とご理解ください。

メインダイヤログのエディットコントロールにどの程度の容量のテキストファイルを読み込めるのか？
ですが、今のところ17M程度は大丈夫のようでした。何らかの制限があるかもしれませんが．．．
　小説家になろうサイトの下記二つのタイトルで動作確認を行いました。

　17Mの本好きの下克上（PDFをテキスト化した後１行が長すぎないよう改行を追加した、１ページの
　文章が１行としてPDF内に入っています。１行がUTF8で１０００文字未満になるよう適度に改行を
　入れてください。）、
　6.5Mの転生したらスライムだった件（テキストファイルをDL後全話１ファイルにまとめたもの）

　テキストファイルをドラッグ＆ドロップしました。問題なく読み込めそうです。
　これらのテキストファイル一通り聞くのに何日も何週間もかかります・・・

　本によって、作者さんの個性で色々な表現方法があります、転スラでは、カタコト表現のカタカナ語
が、mecabでの解析を困難にしている事がありました。

声ヲ沈メテ下サィ！！！		沈　メテ	カタカナなので区切りを誤って"沈"が未登録語になった。
声を沈めて下さぃ！！！		沈め　て

　全てひらがなに直してからmecabに入れようかとも思いましたが、カタカナの名前が多数あって
どうすれば良いか・・・　内部でカタカナ名前をひらがなにしたとしても音として聞くのは変わらない
かも知れません。ただ、辞書はカタカナ名前をひらがなで登録することになるでしょうが。

10:00〜15:00に設定すれば	という文章で　10: 15:　と聞こえる現象の対策を考え中です。
AquesTalkに桁読みで00等(0だけで構成される数字)を入れるとスキップされるようです。
AquesTalkに入れている文字列は
"<NUMK VAL=10>ころん<NUMK VAL=00>"、"<NUMK VAL=15>ころん<NUMK VAL=00>に"
数字':'数字　の並びが在った際':'を時と、':'以降を桁読みしないようにしてみました。
まだ、要改善のようです。

間の波ダッシュは飛ばしているようです。"～"0xEFBD9Eは記号読み時は「から」と読むようにしています。
俗にいう波ダッシュ問題（別文字）ですね。。。"〜"0xE3809Cの読みも辞書登録しておくと吉かもしれません。
改善案などございましたらお知らせください。


　TTSを変えないならば、辞書の読みにそのTTS専用の発音記号、アクセントなども入れることでもう少し
聞きやすくなると思われます。また、MeCabの辞書の全ての語彙を加筆するならば、AquesTalkの読み、
SAPIの読みを別に登録することも可能と思われます。SAPIの出力がもう少し聞き取りやすければ意欲が出る
のですが…　他のTTS対応もしたいですね、聞き取りやすいTTSの作者の方、ご存じの方いらっしゃいました
らご教授ください。

　当初、AquesTalkへの入力にシフトJISを使っていました。それに合わせてMeCabもシフトJISにして
いた所、シフトJISに変換できない文字もあり誤変換されてエラーになるため、UTF-8に変更しました。
余計な変換を無くすためユニコード（UTF-16LE）にしようかとも考えましたが、MeCabのcsv辞書を変換すると
サイズが増えた（半角文字まで２イトになるため）のでやめました。

　他の聞き取りやすく（かわいい声の）TTSでAPIが公開されているものをご存じでしたらお知らせください。


・原因不明のフォント変化

 テキストエディターからクリップボード経由で張り付けた際、何故かフォントが変わってしまうことを
確認しています。対応策を探したのですが、今のところ見つかっていません。半角フォントが変わる現象
については対応策が在るようですが、全角フォントについては見受けられませんでした。
何かご存じの際はご教授頂けるとありがたいです。


・MeCabの誤変換について

　MeCabは下記のような、記号が前後にある分の変換の際読みを誤るようです。

　前に記号が在る場合　字下げで先頭に空白が在った際

　二日目にして
　    記号,空白,*,*,*,*,　,　,　
二日    名詞,数,*,*,*,*,二日,フツカ,フツカ
目    名詞,接尾,助数詞,*,*,*,目,モク,モク
に    助詞,格助詞,一般,*,*,*,に,ニ,ニ
し    動詞,自立,*,*,サ変・スル,連用形,する,シ,シ
て    助詞,接続助詞,*,*,*,*,て,テ,テ
EOS

　コーパスを作る際、先頭の空白を省くと　正常に”メ”と読まれるようです。

二日目にして
二日    名詞,数,*,*,*,*,二日,フツカ,フツカ
目    名詞,一般,*,*,*,*,目,メ,メ
に    助詞,格助詞,一般,*,*,*,に,ニ,ニ
し    動詞,自立,*,*,サ変・スル,連用形,する,シ,シ
て    助詞,接続助詞,*,*,*,*,て,テ,テ
EOS 


　前に記号が在る場合　前にも文が在って句読点が在った際

エーレンフェスト一行から小さな笑いが漏れる。
エーレンフェスト	名詞,固有名詞,地域,一般,*,*,エーレンフェスト,エーレンフェスト,エーレンフェスト
一行	名詞,一般,*,*,*,*,一行,イッコウ,イッコー
から	助詞,格助詞,一般,*,*,*,から,カラ,カラ
EOS

、エーレンフェスト一行から小さな笑いが漏れる。
、	記号,読点,*,*,*,*,、,、,、
エーレンフェスト	名詞,固有名詞,地域,一般,*,*,エーレンフェスト,エーレンフェスト,エーレンフェスト
一	名詞,数,*,*,*,*,一,イチ,イチ
行	名詞,一般,*,*,*,*,行,ギョウ,ギョー
から	助詞,格助詞,一般,*,*,*,から,カラ,カラ
EOS

　後ろに記号が在る場合
魔動処刑機神
魔	名詞,一般,*,*,*,*,魔,マ,マ
動	名詞,一般,*,*,*,*,動,ドウ,ドー
処刑	名詞,サ変接続,*,*,*,*,処刑,ショケイ,ショケイ
機	名詞,接尾,一般,*,*,*,機,キ,キ
神	名詞,接尾,一般,*,*,*,神,シン,シン
EOS

魔動処刑機神（デストロイヤー）
魔	名詞,一般,*,*,*,*,魔,マ,マ
動	名詞,一般,*,*,*,*,動,ドウ,ドー
処刑	名詞,サ変接続,*,*,*,*,処刑,ショケイ,ショケイ
機	名詞,接尾,一般,*,*,*,機,キ,キ
神	名詞,一般,*,*,*,*,神,カミ,カミ
（	記号,括弧開,*,*,*,*,（,（,（
デストロイヤー	名詞,一般,*,*,*,*,デストロイヤー,デストロイヤー,デストロイヤー
）	記号,括弧閉,*,*,*,*,）,）,）
EOS


・AquesTalkの限界

　また、’ヴ’などの読み記号表になく発音できないので、’ぶ’に置き換えて
いますので、違和感を感じられると思います、改善されることを希望します。



・謝辞

　このプログラムを作るにあたり、色々なツールやWebサイトを参考にさせていただきました。
ありがとうございます。


MeCabは 京都大学情報学研究科−日本電信電話株式会社コミュニケーション科学基礎研究所 共同研究
ユニットプロジェクトを通じて開発されたオープンソース 形態素解析エンジンです。

https://taku910.github.io/mecab/

MeCab用IPA辞書
https://taku910.github.io/mecab/#install-windows	本ソフトではUTF-8の辞書を使用しているた
め、UTF-8変換したcsvファイルを同梱しています。

MeCab用IPA辞書のモデルファイル
https://taku910.github.io/mecab/dic.html　ここのコストの自動推定機能の章にダウンロードリンク
が在ります。辞書構築に必要ですので同梱しています。

MeCab用sys.dicビルド方法
https://taku910.github.io/mecab/learn.html


　本ソフトは、(株)アクエストの音声合成ライブラリAquesTalkを使用しており、その著作権は同社に
帰属します。営利目的での使用は当該ライブラリの使用ライセンスが必要です。

https://www.a-quest.com/index.html


参考にさせていただいたサイト

・新語登録時に品詞や形態素について
https://tool.konisimple.net/text/hinshi_keitaiso


・文字コード
https://www.natade.net/webapp/mojicode-kaiseki/#%7B%22dMode%22%3A0%2C%22kText%22%3A%22%22%2C%22kKuten%22%3A1%2C%22kISO2022JP%22%3A0%2C%22kEUCJP%22%3A0%2C%22kSJIS%22%3A1%2C%22kCP932%22%3A1%2C%22kMenKuTen%22%3A1%2C%22kSJIS2004%22%3A1%2C%22kUTF8%22%3A1%2C%22kUTF16%22%3A1%2C%22kUTF32%22%3A1%2C%22kCJK%22%3A1%2C%22kBikou%22%3A1%7D


　～　波ダッシュなどについて
http://x0213.org/wiki/wiki.cgi?page=%C7%C8%A5%C0%A5%C3%A5%B7%A5%E5%CC%E4%C2%EA


　JIS2004について　　叱叱　屏屏　并并　倶俱　剥剝　呑吞　嘘噓　妍姸　痩瘦　繋繫
　今まで読めていた"繋"が読めなくて調べたところ違う文字"繫"でした。
　本好きの下克上では"繫"が２カ所、転生したらスライムだった件では１カ所在ったと思います。
　上記１０種類については、MeCabに渡す前に後の字を前の字に変換しています。
https://www.weblio.jp/wkpja/content/JIS+X+0213_JIS+X+0213%3A2004%E3%81%AE%E6%94%B9%E6%AD%A3

後、旧字体"蠟"　と　略字体"蝋"　が出てきたことも在りますが、これは辞書登録しないと
いけないでしょうか・・・


　ダイヤログコントロールのサイズ変更時自動再配置について
https://qiita.com/aki___/items/2b62486d59c7b74f27ec


　最後に、このプログラムはMeCabに習ってLGPLにしようと思っています。もう少しバグ出しした後に
　開発環境
　Microsoft Visual studio 2010 Professional C++ MFCベース
　64bit　ビルドしています。同梱のlibmecab.dllも64bitビルドしたものです。

　ビルド時に必要なAquesTalkのヘッダーや.libファイル等(aqtk10_win_110.zip)はアクエストさんのHPからダウンロードしてください。
	https://www.a-quest.com/


それでは、皆様の本聞きライフがより良いものとなりますように

　"君はMeCabを使いこなすことが出来るか？"

この点が全てであるような気がしています。

